
change an excel sheet to a csv file
import xlrd
import csv

def csv_from_excel(workbook):
    wb = xlrd.open_workbook(workbook)
    sh = wb.sheet_by_name('Sheet1')
    with open('MS.csv', 'w') as MS:
        wr = csv.writer(MS, quoting=csv.QUOTE_ALL)

        for rownum in range(sh.nrows):
            wr.writerow(sh.row_values(rownum))

    MS.close()

csv_from_excel("MS.xlsx")

#read csv file as a dictionary
#write the csv file as dictionary with gene names as keys and 'unique hits' as values, removing the header
import csv
with open ("MS.csv", mode= 'r') as infile:
    reader = csv.reader(infile)
    next(reader,None)
    with open("MS_new.csv", mode= 'w') as outfile: 
        writer = csv.writer(outfile)
        hitnumbers= {rows[3]:rows[0] for rows in reader}

#convert values in dictionary from strings to floats
hitnumbers_ints= dict((k,float(v)) for k,v in hitnumbers.items())

#convert the dictionary into a list containing all unique hit values >1
hits_list=[]
for key, value in hitnumbers_ints.items():
    if value > 1:
        hits_list.append(key)
        
#read the csv file as a dictionary
#write the csv file as dictionary with gene names as keys and molecular weights as values, removing the header
with open ("MS.csv", mode= 'r') as infile:
    reader = csv.reader(infile)
    next(reader,None)
    with open("MS_new.csv", mode= 'w') as outfile: 
        writer = csv.writer(outfile)
        MW= {rows[3]:rows[4] for rows in reader}
        
#convert values from strings to floats
MW_float= dict((k,float(v)) for k,v in MW.items())

#convert the dictionary into a list containing all gene names with molecular weights in the range of 50-70kDa
MW_list=[]
for key, value in MW_float.items():
    if 50.0 < value < 70.0:
        MW_list.append(key)

#concatenate gene names with >1 unique hits and molecular weights in the range of 50-70 into a master list
sig_hits= (list(set(hits_list) & (set(MW_list))))

import sys
import requests
from bs4 import BeautifulSoup

#find the uiprot website for the given gene.  

def search_uniprot(genes, keyword):
        keyword = keyword.lower()

        #change this list name
        hits = []

        for gene in genes:
            
            gene= gene.lower()

            query_url = "https://www.uniprot.org/uniprot/?query=reviewed:yes+AND+organism:9606+" + gene + "&sort=score"

#search page of given gene for the given keyword searching specifically the function section of a uniprot page

            query_page = requests.get(query_url)
            query_soup = BeautifulSoup(query_page.text, "html.parser")

            if "Sorry, no results found for your search term." not in (str(query_soup.findAll("h2"))):

                entry_id = str(query_soup.tbody.tr["id"])
                entry_url = "https://www.uniprot.org/uniprot/" + entry_id + ".txt"

                entry_page = requests.get(entry_url).text

                entry_page = entry_page.lower()

                start = entry_page.find("""-!-""")
                
                stop = entry_page.find("copyrighted")
                
#If keyword is found on a given uniprot gene page, list the gene.

                if gene in entry_page[start:stop]:
                    if keyword in entry_page.lower():
                        hits.append(gene)
                        #shows genes that were found with keyword
                        print(gene)


        with open(keyword + ".csv", 'w', newline='') as csvfile:
            genewriter = csv.writer(csvfile, delimiter=',', quoting=csv.QUOTE_ALL)
            genewriter.writerow(hits)

search_uniprot(sig_hits, "MAPK")
