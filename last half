


import sys
import requests
from bs4 import BeautifulSoup

#find the uiprot website for the given gene.  

def search_uniprot(genes, keyword):
        keyword = keyword.lower()

        #change this list name
        hits = []

        for gene in genes:
            
            gene= gene.lower()

            query_url = "https://www.uniprot.org/uniprot/?query=reviewed:yes+AND+organism:9606+" + gene + "&sort=score"

#search page of given gene for the given keyword searching specifically the function section of a uniprot page

            query_page = requests.get(query_url)
            query_soup = BeautifulSoup(query_page.text, "html.parser")

            if "Sorry, no results found for your search term." not in (str(query_soup.findAll("h2"))):

                entry_id = str(query_soup.tbody.tr["id"])
                entry_url = "https://www.uniprot.org/uniprot/" + entry_id + ".txt"

                entry_page = requests.get(entry_url).text

                entry_page = entry_page.lower()

                start = entry_page.find("""-!-""")
                
                stop = entry_page.find("copyrighted")
                
#If keyword is found on a given uniprot gene page, list the gene.

                if gene in entry_page[start:stop]:
                    if keyword in entry_page.lower():
                        hits.append(gene)
                        #shows genes that were found with keyword
                        print(gene)


        with open(keyword + ".csv", 'w', newline='') as csvfile:
            genewriter = csv.writer(csvfile, delimiter=',', quoting=csv.QUOTE_ALL)
            genewriter.writerow(hits)

search_uniprot(sig_hits, "MAPK")
